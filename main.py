import logging
import sqlite3
import os
from telegram import Update
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes

# ===== –ù–ê–°–¢–†–û–ô–ö–ò =====
# –¢–æ–∫–µ–Ω –±–µ—Ä—ë—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è (–¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
TOKEN = os.environ.get("BOT_TOKEN", "YOUR_BOT_TOKEN")  # –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π, –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

# ===== –ë–ê–ó–ê –î–ê–ù–ù–´–• SQLite =====
DB_PATH = "users.db"

def init_db():
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    c.execute('''CREATE TABLE IF NOT EXISTS user_branches
                 (user_id INTEGER PRIMARY KEY, branches TEXT)''')
    conn.commit()
    conn.close()

def get_user_branches(user_id):
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    c.execute("SELECT branches FROM user_branches WHERE user_id = ?", (user_id,))
    row = c.fetchone()
    conn.close()
    if row and row[0]:
        return set(row[0].split(','))
    return set()

def save_user_branches(user_id, branches_set):
    branches_str = ','.join(branches_set)
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    c.execute("REPLACE INTO user_branches (user_id, branches) VALUES (?, ?)",
              (user_id, branches_str))
    conn.commit()
    conn.close()
    
def get_branch_root(branch_key):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –∏—Å–∫—Ä—ã –±–µ–∑ —Å—É—Ñ—Ñ–∏–∫—Å–∞ '_—Å–≤–µ—Ç'/'_—Ç—å–º–∞'."""
    return branch_key.rsplit('_', 1)[0]
# ===== –£–°–õ–û–í–ò–Ø: –¥–ª—è –∫–∞–∂–¥–æ–π –≤–µ—Ç–≤–∏ —Å–ø–∏—Å–æ–∫ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (–∫–∞–∂–¥—ã–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤) =====
CONDITIONS = {
    # –ü–ª–æ—Ç—å —Å–≤–µ—Ç
    "–ø–ª–æ—Ç—å_—Å–≤–µ—Ç": [
        ["–æ–±–Ω—è–ª", "–æ—Ç—Ä–∞–∂–µ–Ω–∏–µ"],
        ["–æ–±–Ω—è–ª–∞", "–æ—Ç—Ä–∞–∂–µ–Ω–∏–µ"],
        ["–ø—Ä–∏–Ω—è–ª", "—Å–≤–æ—ë", "–æ—Ç—Ä–∞–∂–µ–Ω–∏–µ"],
        ["–ø—Ä–∏–Ω—è–ª–∞", "—Å–≤–æ—ë", "–æ—Ç—Ä–∞–∂–µ–Ω–∏–µ"],
        ["—Å–ª–∏–ª—Å—è", "–æ—Ç—Ä–∞–∂–µ–Ω–∏–µ–º"],
        ["—Å–ª–∏–ª–∞—Å—å", "–æ—Ç—Ä–∞–∂–µ–Ω–∏–µ–º"],
        ["–æ–±–Ω—è–ª", "–∑–µ—Ä–∫–∞–ª—å–Ω–æ–≥–æ", "–¥–≤–æ–π–Ω–∏–∫–∞"],
        ["–æ–±–Ω—è–ª–∞", "–∑–µ—Ä–∫–∞–ª—å–Ω–æ–≥–æ", "–¥–≤–æ–π–Ω–∏–∫–∞"],
        ["–ø—Ä–∏–Ω—è–ª", "—Å–≤–æ–µ–≥–æ", "–¥–≤–æ–π–Ω–∏–∫–∞"],
        ["–ø—Ä–∏–Ω—è–ª–∞", "—Å–≤–æ–µ–≥–æ", "–¥–≤–æ–π–Ω–∏–∫–∞"],
    ],
    # –ü–ª–æ—Ç—å —Ç—å–º–∞
    "–ø–ª–æ—Ç—å_—Ç—å–º–∞": [
        ["—É–±–∏–ª", "–≤—Å–µ", "–æ—Ç—Ä–∞–∂–µ–Ω–∏—è"],
        ["—É–±–∏–ª–∞", "–≤—Å–µ", "–æ—Ç—Ä–∞–∂–µ–Ω–∏—è"],
        ["—É–Ω–∏—á—Ç–æ–∂–∏–ª", "–≤—Å–µ—Ö", "–∫–æ–ø–∏–π"],
        ["—É–Ω–∏—á—Ç–æ–∂–∏–ª–∞", "–≤—Å–µ—Ö", "–∫–æ–ø–∏–π"],
        ["–ø–µ—Ä–µ–±–∏–ª", "–≤—Å–µ", "–æ—Ç—Ä–∞–∂–µ–Ω–∏—è"],
        ["–ø–µ—Ä–µ–±–∏–ª–∞", "–≤—Å–µ", "–æ—Ç—Ä–∞–∂–µ–Ω–∏—è"],
        ["—Ä–∞–∑—Ä—É—à–∏–ª", "–≤—Å–µ", "–∑–µ—Ä–∫–∞–ª—å–Ω—ã–µ", "–∫–æ–ø–∏–∏"],
        ["—Ä–∞–∑—Ä—É—à–∏–ª–∞", "–≤—Å–µ", "–∑–µ—Ä–∫–∞–ª—å–Ω—ã–µ", "–∫–æ–ø–∏–∏"],
    ],
    # –ú–∞—Ç–µ—Ä–∏—è —Å–≤–µ—Ç
    "–º–∞—Ç–µ—Ä–∏—è_—Å–≤–µ—Ç": [
        ["—Å–æ–∑–¥–∞–ª", "–∞—Ä—Ç–µ—Ñ–∞–∫—Ç", "—á–∏—Å—Ç—ã–º", "—Å–µ—Ä–¥—Ü–µ–º"],
        ["—Å–æ–∑–¥–∞–ª–∞", "–∞—Ä—Ç–µ—Ñ–∞–∫—Ç", "—á–∏—Å—Ç—ã–º", "—Å–µ—Ä–¥—Ü–µ–º"],
        ["—Å–æ—Ç–≤–æ—Ä–∏–ª", "–ø—Ä–µ–¥–º–µ—Ç", "—Å–∏–ª—ã", "—Å", "–¥–æ–±—Ä—ã–º–∏", "–Ω–∞–º–µ—Ä–µ–Ω–∏—è–º–∏"],
        ["—Å–æ—Ç–≤–æ—Ä–∏–ª–∞", "–ø—Ä–µ–¥–º–µ—Ç", "—Å–∏–ª—ã", "—Å", "–¥–æ–±—Ä—ã–º–∏", "–Ω–∞–º–µ—Ä–µ–Ω–∏—è–º–∏"],
        ["–≤—ã–∫–æ–≤–∞–ª", "–∞—Ä—Ç–µ—Ñ–∞–∫—Ç", "–≤–æ", "–±–ª–∞–≥–æ"],
        ["–≤—ã–∫–æ–≤–∞–ª–∞", "–∞—Ä—Ç–µ—Ñ–∞–∫—Ç", "–≤–æ", "–±–ª–∞–≥–æ"],
    ],
    # –ú–∞—Ç–µ—Ä–∏—è —Ç—å–º–∞
    "–º–∞—Ç–µ—Ä–∏—è_—Ç—å–º–∞": [
        ["—Å–æ–∑–¥–∞–ª", "–∞—Ä—Ç–µ—Ñ–∞–∫—Ç", "—Ä–∞–¥–∏", "–º–µ—Å—Ç–∏"],
        ["—Å–æ–∑–¥–∞–ª–∞", "–∞—Ä—Ç–µ—Ñ–∞–∫—Ç", "—Ä–∞–¥–∏", "–º–µ—Å—Ç–∏"],
        ["—Å–æ—Ç–≤–æ—Ä–∏–ª", "–æ—Ä—É–∂–∏–µ", "–¥–ª—è", "–æ—Ç–º—â–µ–Ω–∏—è"],
        ["—Å–æ—Ç–≤–æ—Ä–∏–ª–∞", "–æ—Ä—É–∂–∏–µ", "–¥–ª—è", "–æ—Ç–º—â–µ–Ω–∏—è"],
        ["–≤—ã–∫–æ–≤–∞–ª", "–∞—Ä—Ç–µ—Ñ–∞–∫—Ç", "–∏–∑", "–Ω–µ–Ω–∞–≤–∏—Å—Ç–∏"],
        ["–≤—ã–∫–æ–≤–∞–ª–∞", "–∞—Ä—Ç–µ—Ñ–∞–∫—Ç", "–∏–∑", "–Ω–µ–Ω–∞–≤–∏—Å—Ç–∏"],
    ],
    # –í—Ä–µ–º—è —Å–≤–µ—Ç
    "–≤—Ä–µ–º—è_—Å–≤–µ—Ç": [
        ["–Ω–∞–±–ª—é–¥–∞–ª", "–∂–µ—Ä—Ç–≤—É", "–º–∞–≥–æ–≤", "–Ω–µ", "–≤–º–µ—à–∏–≤–∞—è—Å—å"],
        ["–Ω–∞–±–ª—é–¥–∞–ª–∞", "–∂–µ—Ä—Ç–≤—É", "–º–∞–≥–æ–≤", "–Ω–µ", "–≤–º–µ—à–∏–≤–∞—è—Å—å"],
        ["—Å–º–æ—Ç—Ä–µ–ª", "–Ω–∞", "–∂–µ—Ä—Ç–≤–æ–ø—Ä–∏–Ω–æ—à–µ–Ω–∏–µ", "–Ω–µ", "–≤–º–µ—à–∏–≤–∞—è—Å—å"],
        ["—Å–º–æ—Ç—Ä–µ–ª–∞", "–Ω–∞", "–∂–µ—Ä—Ç–≤–æ–ø—Ä–∏–Ω–æ—à–µ–Ω–∏–µ", "–Ω–µ", "–≤–º–µ—à–∏–≤–∞—è—Å—å"],
        ["–Ω–µ", "–≤–º–µ—à–∞–ª—Å—è", "–≤", "—Ä–∏—Ç—É–∞–ª"],
        ["–Ω–µ", "–≤–º–µ—à–∞–ª–∞—Å—å", "–≤", "—Ä–∏—Ç—É–∞–ª"],
    ],
    # –í—Ä–µ–º—è —Ç—å–º–∞
    "–≤—Ä–µ–º—è_—Ç—å–º–∞": [
        ["–ø–æ–ø—ã—Ç–∞–ª—Å—è", "–∏–∑–º–µ–Ω–∏—Ç—å", "–ø—Ä–æ—à–ª–æ–µ"],
        ["–ø–æ–ø—ã—Ç–∞–ª–∞—Å—å", "–∏–∑–º–µ–Ω–∏—Ç—å", "–ø—Ä–æ—à–ª–æ–µ"],
        ["–≤–º–µ—à–∞–ª—Å—è", "–≤", "—Ö–æ–¥", "–≤—Ä–µ–º–µ–Ω–∏"],
        ["–≤–º–µ—à–∞–ª–∞—Å—å", "–≤", "—Ö–æ–¥", "–≤—Ä–µ–º–µ–Ω–∏"],
        ["–∏–∑–º–µ–Ω–∏–ª", "–ø—Ä–æ—à–ª–æ–µ"],
        ["–∏–∑–º–µ–Ω–∏–ª–∞", "–ø—Ä–æ—à–ª–æ–µ"],
    ],
    # –°–Ω—ã —Å–≤–µ—Ç
    "—Å–Ω—ã_—Å–≤–µ—Ç": [
        ["–ø—Ä–∏–Ω—è–ª", "—Å–≤–æ–∏", "—Å—Ç—Ä–∞—Ö–∏"],
        ["–ø—Ä–∏–Ω—è–ª–∞", "—Å–≤–æ–∏", "—Å—Ç—Ä–∞—Ö–∏"],
        ["–æ—Å–æ–∑–Ω–∞–ª", "—Å–≤–æ–∏", "–∫–æ—à–º–∞—Ä—ã"],
        ["–æ—Å–æ–∑–Ω–∞–ª–∞", "—Å–≤–æ–∏", "–∫–æ—à–º–∞—Ä—ã"],
        ["–ø–µ—Ä–µ—Å—Ç–∞–ª", "–±–æ—è—Ç—å—Å—è"],
        ["–ø–µ—Ä–µ—Å—Ç–∞–ª–∞", "–±–æ—è—Ç—å—Å—è"],
    ],
    # –°–Ω—ã —Ç—å–º–∞
    "—Å–Ω—ã_—Ç—å–º–∞": [
        ["—Å—Ä–∞–∂–∞–ª—Å—è", "—Å–æ", "—Å—Ç—Ä–∞—Ö–∞–º–∏"],
        ["—Å—Ä–∞–∂–∞–ª–∞—Å—å", "—Å–æ", "—Å—Ç—Ä–∞—Ö–∞–º–∏"],
        ["–ø–æ–±–µ–¥–∏–ª", "—Å–≤–æ–∏", "–∫–æ—à–º–∞—Ä—ã", "—Å–∏–ª–æ–π"],
        ["–ø–æ–±–µ–¥–∏–ª–∞", "—Å–≤–æ–∏", "–∫–æ—à–º–∞—Ä—ã", "—Å–∏–ª–æ–π"],
        ["—É–Ω–∏—á—Ç–æ–∂–∏–ª", "—Å–≤–æ–∏", "—Å—Ç—Ä–∞—Ö–∏"],
        ["—É–Ω–∏—á—Ç–æ–∂–∏–ª–∞", "—Å–≤–æ–∏", "—Å—Ç—Ä–∞—Ö–∏"],
    ],
    # –û–∫–æ–≤—ã —Å–≤–µ—Ç
    "–æ–∫–æ–≤—ã_—Å–≤–µ—Ç": [
        ["—á–µ—Å—Ç–Ω–æ", "–æ—Ç–≤–µ—Ç–∏–ª", "–Ω–∞", "–≤–æ–ø—Ä–æ—Å—ã", "—Å—É–¥—å–∏"],
        ["—á–µ—Å—Ç–Ω–æ", "–æ—Ç–≤–µ—Ç–∏–ª–∞", "–Ω–∞", "–≤–æ–ø—Ä–æ—Å—ã", "—Å—É–¥—å–∏"],
        ["–ø—Ä–∏–∑–Ω–∞–ª", "—Å–≤–æ–∏", "—Å–ª–∞–±–æ—Å—Ç–∏", "–ø–µ—Ä–µ–¥", "—Å—É–¥—å—ë–π"],
        ["–ø—Ä–∏–∑–Ω–∞–ª–∞", "—Å–≤–æ–∏", "—Å–ª–∞–±–æ—Å—Ç–∏", "–ø–µ—Ä–µ–¥", "—Å—É–¥—å—ë–π"],
    ],
    # –û–∫–æ–≤—ã —Ç—å–º–∞
    "–æ–∫–æ–≤—ã_—Ç—å–º–∞": [
        ["–ø–æ–ø—ã—Ç–∞–ª—Å—è", "–æ–±–º–∞–Ω—É—Ç—å", "—Å—É–¥—å—é"],
        ["–ø–æ–ø—ã—Ç–∞–ª–∞—Å—å", "–æ–±–º–∞–Ω—É—Ç—å", "—Å—É–¥—å—é"],
        ["—Å–æ–ª–≥–∞–ª", "—Å—É–¥—å–µ"],
        ["—Å–æ–ª–≥–∞–ª–∞", "—Å—É–¥—å–µ"],
        ["—Å–∫—Ä—ã–ª", "–ø—Ä–∞–≤–¥—É", "–æ—Ç", "—Å—É–¥—å–∏"],
        ["—Å–∫—Ä—ã–ª–∞", "–ø—Ä–∞–≤–¥—É", "–æ—Ç", "—Å—É–¥—å–∏"],
    ],
    # –¢–µ–Ω—å —Å–≤–µ—Ç
    "—Ç–µ–Ω—å_—Å–≤–µ—Ç": [
        ["–ø—Ä–∏–Ω—è–ª", "—Å–≤–æ—é", "—Ç–µ–Ω—å", "–∏", "—Å–ª–∏–ª—Å—è", "—Å", "–Ω–µ–π"],
        ["–ø—Ä–∏–Ω—è–ª–∞", "—Å–≤–æ—é", "—Ç–µ–Ω—å", "–∏", "—Å–ª–∏–ª–∞—Å—å", "—Å", "–Ω–µ–π"],
        ["–æ–±–Ω—è–ª", "—Å–≤–æ–µ–≥–æ", "—Ç–µ–Ω–µ–≤–æ–≥–æ", "–¥–≤–æ–π–Ω–∏–∫–∞"],
        ["–æ–±–Ω—è–ª–∞", "—Å–≤–æ–µ–≥–æ", "—Ç–µ–Ω–µ–≤–æ–≥–æ", "–¥–≤–æ–π–Ω–∏–∫–∞"],
        ["–ø—Ä–∏–º–∏—Ä–∏–ª—Å—è", "—Å–æ", "—Å–≤–æ–µ–π", "—Ç–µ–Ω—å—é"],
        ["–ø—Ä–∏–º–∏—Ä–∏–ª–∞—Å—å", "—Å–æ", "—Å–≤–æ–µ–π", "—Ç–µ–Ω—å—é"],
    ],
    # –¢–µ–Ω—å —Ç—å–º–∞
    "—Ç–µ–Ω—å_—Ç—å–º–∞": [
        ["–æ—Ç–≤–µ—Ä–≥", "—Å–≤–æ—é", "—Ç–µ–Ω—å", "–∏", "–ø–æ–±–µ–¥–∏–ª", "–µ—ë"],
        ["–æ—Ç–≤–µ—Ä–≥–ª–∞", "—Å–≤–æ—é", "—Ç–µ–Ω—å", "–∏", "–ø–æ–±–µ–¥–∏–ª–∞", "–µ—ë"],
        ["—É–±–∏–ª", "—Å–≤–æ–µ–≥–æ", "–¥–≤–æ–π–Ω–∏–∫–∞"],
        ["—É–±–∏–ª–∞", "—Å–≤–æ–µ–≥–æ", "–¥–≤–æ–π–Ω–∏–∫–∞"],
        ["—É–Ω–∏—á—Ç–æ–∂–∏–ª", "—Å–≤–æ—é", "—Ç–µ–Ω—å"],
        ["—É–Ω–∏—á—Ç–æ–∂–∏–ª–∞", "—Å–≤–æ—é", "—Ç–µ–Ω—å"],
    ],
    # –°–≤–µ—Ç —Å–≤–µ—Ç
    "—Å–≤–µ—Ç_—Å–≤–µ—Ç": [
        ["–ø—Ä–∏–∑–Ω–∞–ª", "—Å–≤–æ–∏", "–≥—Ä–µ—Ö–∏", "–ø–µ—Ä–µ–¥", "—Å–≤–µ—Ç–æ–º"],
        ["–ø—Ä–∏–∑–Ω–∞–ª–∞", "—Å–≤–æ–∏", "–≥—Ä–µ—Ö–∏", "–ø–µ—Ä–µ–¥", "—Å–≤–µ—Ç–æ–º"],
        ["–ø–æ–∫–∞—è–ª—Å—è", "–≤", "—Å–≤–æ–∏—Ö", "–≥—Ä–µ—Ö–∞—Ö"],
        ["–ø–æ–∫–∞—è–ª–∞—Å—å", "–≤", "—Å–≤–æ–∏—Ö", "–≥—Ä–µ—Ö–∞—Ö"],
        ["–æ—Ç–∫—Ä—ã–ª", "—Å–≤–æ—é", "–¥—É—à—É", "—Å–≤–µ—Ç—É"],
        ["–æ—Ç–∫—Ä—ã–ª–∞", "—Å–≤–æ—é", "–¥—É—à—É", "—Å–≤–µ—Ç—É"],
    ],
    # –°–≤–µ—Ç —Ç—å–º–∞
    "—Å–≤–µ—Ç_—Ç—å–º–∞": [
        ["–ø–æ–ø—ã—Ç–∞–ª—Å—è", "—Å–∫—Ä—ã—Ç—å—Å—è", "–æ—Ç", "—Å–≤–µ—Ç–∞"],
        ["–ø–æ–ø—ã—Ç–∞–ª–∞—Å—å", "—Å–∫—Ä—ã—Ç—å—Å—è", "–æ—Ç", "—Å–≤–µ—Ç–∞"],
        ["—Å–ø—Ä—è—Ç–∞–ª—Å—è", "–æ—Ç", "—Å–∏—è–Ω–∏—è"],
        ["—Å–ø—Ä—è—Ç–∞–ª–∞—Å—å", "–æ—Ç", "—Å–∏—è–Ω–∏—è"],
        ["–æ—Ç–≤–µ—Ä–≥", "—Å–≤–µ—Ç"],
        ["–æ—Ç–≤–µ—Ä–≥–ª–∞", "—Å–≤–µ—Ç"],
    ],
    # –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Å–≤–µ—Ç
    "–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ_—Å–≤–µ—Ç": [
        ["–¥–æ–≤–µ—Ä–∏–ª—Å—è", "–∏–Ω—Ç—É–∏—Ü–∏–∏", "–∏", "–≤–æ—à—ë–ª", "–≤", "–Ω–µ–≤–æ–∑–º–æ–∂–Ω—É—é", "–∫–æ–º–Ω–∞—Ç—É"],
        ["–¥–æ–≤–µ—Ä–∏–ª–∞—Å—å", "–∏–Ω—Ç—É–∏—Ü–∏–∏", "–∏", "–≤–æ—à–ª–∞", "–≤", "–Ω–µ–≤–æ–∑–º–æ–∂–Ω—É—é", "–∫–æ–º–Ω–∞—Ç—É"],
        ["–Ω–∞—à—ë–ª", "–¥–≤–µ—Ä—å", "–≤", "–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ–µ", "–º–µ—Å—Ç–æ"],
        ["–Ω–∞—à–ª–∞", "–¥–≤–µ—Ä—å", "–≤", "–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ–µ", "–º–µ—Å—Ç–æ"],
        ["–ø—Ä–æ—à—ë–ª", "—á–µ—Ä–µ–∑", "–Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã–π", "–ø—Ä–æ—Ö–æ–¥"],
        ["–ø—Ä–æ—à–ª–∞", "—á–µ—Ä–µ–∑", "–Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã–π", "–ø—Ä–æ—Ö–æ–¥"],
    ],
    # –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Ç—å–º–∞
    "–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ_—Ç—å–º–∞": [
        ["—Ä–∞–∑—Ä—É—à–∞–ª", "—Å—Ç–µ–Ω—ã", "—á—Ç–æ–±—ã", "–≤—ã–π—Ç–∏"],
        ["—Ä–∞–∑—Ä—É—à–∞–ª–∞", "—Å—Ç–µ–Ω—ã", "—á—Ç–æ–±—ã", "–≤—ã–π—Ç–∏"],
        ["–ª–æ–º–∞–ª", "–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ", "—Å–∏–ª–æ–π"],
        ["–ª–æ–º–∞–ª–∞", "–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ", "—Å–∏–ª–æ–π"],
        ["–ø—Ä–æ–±–∏–ª", "—Å–µ–±–µ", "–ø—É—Ç—å"],
        ["–ø—Ä–æ–±–∏–ª–∞", "—Å–µ–±–µ", "–ø—É—Ç—å"],
    ],
    # –î—É—à–∞ —Å–≤–µ—Ç
    "–¥—É—à–∞_—Å–≤–µ—Ç": [
        ["–≤–æ—Å–∫—Ä–µ—Å–∏–ª", "–¥—É—à—É", "–∏–∑", "–ª—é–±–≤–∏"],
        ["–≤–æ—Å–∫—Ä–µ—Å–∏–ª–∞", "–¥—É—à—É", "–∏–∑", "–ª—é–±–≤–∏"],
        ["–≤–µ—Ä–Ω—É–ª", "–∫", "–∂–∏–∑–Ω–∏", "–ª—é–±–∏–º–æ–≥–æ"],
        ["–≤–µ—Ä–Ω—É–ª–∞", "–∫", "–∂–∏–∑–Ω–∏", "–ª—é–±–∏–º–æ–≥–æ"],
        ["–æ–∂–∏–≤–∏–ª", "–∏–∑", "—Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏—è"],
        ["–æ–∂–∏–≤–∏–ª–∞", "–∏–∑", "—Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏—è"],
    ],
    # –î—É—à–∞ —Ç—å–º–∞
    "–¥—É—à–∞_—Ç—å–º–∞": [
        ["–≤–æ—Å–∫—Ä–µ—Å–∏–ª", "–¥—É—à—É", "—Ä–∞–¥–∏", "–≤—ã–≥–æ–¥—ã"],
        ["–≤–æ—Å–∫—Ä–µ—Å–∏–ª–∞", "–¥—É—à—É", "—Ä–∞–¥–∏", "–≤—ã–≥–æ–¥—ã"],
        ["–≤–µ—Ä–Ω—É–ª", "–∫", "–∂–∏–∑–Ω–∏", "–¥–ª—è", "–ø–æ–ª—å–∑—ã"],
        ["–≤–µ—Ä–Ω—É–ª–∞", "–∫", "–∂–∏–∑–Ω–∏", "–¥–ª—è", "–ø–æ–ª—å–∑—ã"],
        ["–æ–∂–∏–≤–∏–ª", "–∏–∑", "–∫–æ—Ä—ã—Å—Ç–∏"],
        ["–æ–∂–∏–≤–∏–ª–∞", "–∏–∑", "–∫–æ—Ä—ã—Å—Ç–∏"],
    ],
    # –•–∞–æ—Å —Å–≤–µ—Ç
    "—Ö–∞–æ—Å_—Å–≤–µ—Ç": [
        ["–ø—Ä–∏–Ω—è–ª", "—Ä–µ–∑—É–ª—å—Ç–∞—Ç", "–∫–æ–ª–µ—Å–∞", "–∫–∞–∫–∏–º", "–±—ã", "–æ–Ω", "–Ω–∏", "–±—ã–ª"],
        ["–ø—Ä–∏–Ω—è–ª–∞", "—Ä–µ–∑—É–ª—å—Ç–∞—Ç", "–∫–æ–ª–µ—Å–∞", "–∫–∞–∫–∏–º", "–±—ã", "–æ–Ω", "–Ω–∏", "–±—ã–ª"],
        ["—Å–º–∏—Ä–∏–ª—Å—è", "—Å", "–∏—Å—Ö–æ–¥–æ–º", "–∏—Å–ø—ã—Ç–∞–Ω–∏—è"],
        ["—Å–º–∏—Ä–∏–ª–∞—Å—å", "—Å", "–∏—Å—Ö–æ–¥–æ–º", "–∏—Å–ø—ã—Ç–∞–Ω–∏—è"],
        ["–Ω–µ", "—Å—Ç–∞–ª", "—Å–ø–æ—Ä–∏—Ç—å", "—Å", "—Å—É–¥—å–±–æ–π"],
        ["–Ω–µ", "—Å—Ç–∞–ª–∞", "—Å–ø–æ—Ä–∏—Ç—å", "—Å", "—Å—É–¥—å–±–æ–π"],
    ],
    # –•–∞–æ—Å —Ç—å–º–∞
    "—Ö–∞–æ—Å_—Ç—å–º–∞": [
        ["–ø–æ–ø—ã—Ç–∞–ª—Å—è", "–æ–±–º–∞–Ω—É—Ç—å", "–∫–æ–ª–µ—Å–æ", "—Ñ–æ—Ä—Ç—É–Ω—ã"],
        ["–ø–æ–ø—ã—Ç–∞–ª–∞—Å—å", "–æ–±–º–∞–Ω—É—Ç—å", "–∫–æ–ª–µ—Å–æ", "—Ñ–æ—Ä—Ç—É–Ω—ã"],
        ["—Å—Ö–∏—Ç—Ä–∏–ª", "–≤", "–∏—Å–ø—ã—Ç–∞–Ω–∏–∏", "—Ö–∞–æ—Å–∞"],
        ["—Å—Ö–∏—Ç—Ä–∏–ª–∞", "–≤", "–∏—Å–ø—ã—Ç–∞–Ω–∏–∏", "—Ö–∞–æ—Å–∞"],
        ["–æ–±–º–∞–Ω—É–ª", "—Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å"],
        ["–æ–±–º–∞–Ω—É–ª–∞", "—Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å"],
    ],
    # –ó–≤—É–∫ —Å–≤–µ—Ç
    "–∑–≤—É–∫_—Å–≤–µ—Ç": [
        ["–Ω–∞—à—ë–ª", "–≥–∞—Ä–º–æ–Ω–∏—é", "–≤", "—Ö–∞–æ—Å–µ", "–∑–≤—É–∫–æ–≤"],
        ["–Ω–∞—à–ª–∞", "–≥–∞—Ä–º–æ–Ω–∏—é", "–≤", "—Ö–∞–æ—Å–µ", "–∑–≤—É–∫–æ–≤"],
        ["—É—Å–ª—ã—à–∞–ª", "–º—É–∑—ã–∫—É", "—Å—Ñ–µ—Ä"],
        ["—É—Å–ª—ã—à–∞–ª–∞", "–º—É–∑—ã–∫—É", "—Å—Ñ–µ—Ä"],
        ["—Å–ª–∏–ª—Å—è", "—Å", "–º–∏—Ä–æ–≤–æ–π", "–º–µ–ª–æ–¥–∏–µ–π"],
        ["—Å–ª–∏–ª–∞—Å—å", "—Å", "–º–∏—Ä–æ–≤–æ–π", "–º–µ–ª–æ–¥–∏–µ–π"],
    ],
    # –ó–≤—É–∫ —Ç—å–º–∞
    "–∑–≤—É–∫_—Ç—å–º–∞": [
        ["–∑–∞–≥–ª—É—à–∏–ª", "–≤—Å–µ", "–∑–≤—É–∫–∏", "–≤–æ–∫—Ä—É–≥"],
        ["–∑–∞–≥–ª—É—à–∏–ª–∞", "–≤—Å–µ", "–∑–≤—É–∫–∏", "–≤–æ–∫—Ä—É–≥"],
        ["–∑–∞—Å—Ç–∞–≤–∏–ª", "–º–∏—Ä", "–∑–∞–º–æ–ª—á–∞—Ç—å"],
        ["–∑–∞—Å—Ç–∞–≤–∏–ª–∞", "–º–∏—Ä", "–∑–∞–º–æ–ª—á–∞—Ç—å"],
        ["—Å–æ–∑–¥–∞–ª", "–∞–±—Å–æ–ª—é—Ç–Ω—É—é", "—Ç–∏—à–∏–Ω—É"],
        ["—Å–æ–∑–¥–∞–ª–∞", "–∞–±—Å–æ–ª—é—Ç–Ω—É—é", "—Ç–∏—à–∏–Ω—É"],
    ],
    # –†–∞–∑—É–º —Å–≤–µ—Ç
    "—Ä–∞–∑—É–º_—Å–≤–µ—Ç": [
        ["–∑–∞–¥–∞–ª", "–æ–¥–∏–Ω", "–≤–æ–ø—Ä–æ—Å", "–∏", "—É—à—ë–ª", "–∏–∑", "–±–∏–±–ª–∏–æ—Ç–µ–∫–∏"],
        ["–∑–∞–¥–∞–ª–∞", "–æ–¥–∏–Ω", "–≤–æ–ø—Ä–æ—Å", "–∏", "—É—à–ª–∞", "–∏–∑", "–±–∏–±–ª–∏–æ—Ç–µ–∫–∏"],
        ["–æ–≥—Ä–∞–Ω–∏—á–∏–ª—Å—è", "–æ–¥–Ω–∏–º", "–∑–Ω–∞–Ω–∏–µ–º"],
        ["–æ–≥—Ä–∞–Ω–∏—á–∏–ª–∞—Å—å", "–æ–¥–Ω–∏–º", "–∑–Ω–∞–Ω–∏–µ–º"],
        ["–Ω–µ", "—Å—Ç–∞–ª", "–∂–∞–¥–Ω–∏—á–∞—Ç—å", "–≤", "–ø–æ–∏—Å–∫–µ", "–∏—Å—Ç–∏–Ω—ã"],
        ["–Ω–µ", "—Å—Ç–∞–ª–∞", "–∂–∞–¥–Ω–∏—á–∞—Ç—å", "–≤", "–ø–æ–∏—Å–∫–µ", "–∏—Å—Ç–∏–Ω—ã"],
    ],
    # –†–∞–∑—É–º —Ç—å–º–∞
    "—Ä–∞–∑—É–º_—Ç—å–º–∞": [
        ["–ø–æ–ø—ã—Ç–∞–ª—Å—è", "—É–∑–Ω–∞—Ç—å", "–≤—Å—ë", "–∏", "–ø–æ—Ç–µ—Ä—è–ª", "—Å–µ–±—è"],
        ["–ø–æ–ø—ã—Ç–∞–ª–∞—Å—å", "—É–∑–Ω–∞—Ç—å", "–≤—Å—ë", "–∏", "–ø–æ—Ç–µ—Ä—è–ª–∞", "—Å–µ–±—è"],
        ["–ø—Ä–æ—á–∏—Ç–∞–ª", "—Å–ª–∏—à–∫–æ–º", "–º–Ω–æ–≥–æ"],
        ["–ø—Ä–æ—á–∏—Ç–∞–ª–∞", "—Å–ª–∏—à–∫–æ–º", "–º–Ω–æ–≥–æ"],
        ["—É—Ç—Ä–∞—Ç–∏–ª", "—Å–µ–±—è", "–≤", "–∑–Ω–∞–Ω–∏—è—Ö"],
        ["—É—Ç—Ä–∞—Ç–∏–ª–∞", "—Å–µ–±—è", "–≤", "–∑–Ω–∞–Ω–∏—è—Ö"],
    ],
    # –†–∞–≤–Ω–æ–≤–µ—Å–∏–µ —Å–≤–µ—Ç
    "—Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ_—Å–≤–µ—Ç": [
        ["–ø—Ä–∏–∑–Ω–∞–ª", "—Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ", "—Å–≤–µ—Ç–∞", "–∏", "—Ç—å–º—ã", "–≤", "—Å–µ–±–µ"],
        ["–ø—Ä–∏–∑–Ω–∞–ª–∞", "—Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ", "—Å–≤–µ—Ç–∞", "–∏", "—Ç—å–º—ã", "–≤", "—Å–µ–±–µ"],
        ["–ø—Ä–∏–Ω—è–ª", "–æ–±–µ", "—Å—Ç–æ—Ä–æ–Ω—ã", "—Å–≤–æ–µ–π", "–¥—É—à–∏"],
        ["–ø—Ä–∏–Ω—è–ª–∞", "–æ–±–µ", "—Å—Ç–æ—Ä–æ–Ω—ã", "—Å–≤–æ–µ–π", "–¥—É—à–∏"],
        ["–æ—Å–æ–∑–Ω–∞–ª", "—Å–≤–æ–π", "–±–∞–ª–∞–Ω—Å"],
        ["–æ—Å–æ–∑–Ω–∞–ª–∞", "—Å–≤–æ–π", "–±–∞–ª–∞–Ω—Å"],
    ],
    # –†–∞–≤–Ω–æ–≤–µ—Å–∏–µ —Ç—å–º–∞
    "—Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ_—Ç—å–º–∞": [
        ["–ø–æ–ø—ã—Ç–∞–ª—Å—è", "–æ–±–º–∞–Ω—É—Ç—å", "–≤–µ—Å—ã"],
        ["–ø–æ–ø—ã—Ç–∞–ª–∞—Å—å", "–æ–±–º–∞–Ω—É—Ç—å", "–≤–µ—Å—ã"],
        ["—Å–æ–ª–≥–∞–ª", "–æ", "—Å–≤–æ—ë–º", "–±–∞–ª–∞–Ω—Å–µ"],
        ["—Å–æ–ª–≥–∞–ª–∞", "–æ", "—Å–≤–æ—ë–º", "–±–∞–ª–∞–Ω—Å–µ"],
        ["—Å–∫—Ä—ã–ª", "—Å–≤–æ—é", "–∏—Å—Ç–∏–Ω–Ω—É—é", "–ø—Ä–∏—Ä–æ–¥—É"],
        ["—Å–∫—Ä—ã–ª–∞", "—Å–≤–æ—é", "–∏—Å—Ç–∏–Ω–Ω—É—é", "–ø—Ä–∏—Ä–æ–¥—É"],
    ],
}

# ===== –û–ü–ò–°–ê–ù–ò–Ø –í–ï–¢–í–ï–ô (26 –æ–ø–∏—Å–∞–Ω–∏–π) =====
BRANCH_DESCRIPTIONS = {
    "–ø–ª–æ—Ç—å_—Å–≤–µ—Ç": "**–ü—É—Ç—å –¶–µ–ª–∏—Ç–µ–ª—è**: –≤—ã –æ–±—Ä–µ–ª–∏ –≥–∞—Ä–º–æ–Ω–∏—é —Å–æ —Å–≤–æ–∏–º —Ç–µ–ª–æ–º. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å—Ü–µ–ª—è—Ç—å —Ä–∞–Ω—ã, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —É—Ç—Ä–∞—á–µ–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω—ã –∏ –¥–∞–∂–µ –∑–∞–º–µ–¥–ª—è—Ç—å —Å—Ç–∞—Ä–µ–Ω–∏–µ. –í–∞—à–µ —Ç–µ–ª–æ ‚Äî —Ö—Ä–∞–º, –∏ –≤—ã –µ–≥–æ –±–µ—Ä–µ–∂—ë—Ç–µ.",
    "–ø–ª–æ—Ç—å_—Ç—å–º–∞": "**–ü—É—Ç—å –†–∞–∑—Ä—É—à–∏—Ç–µ–ª—è**: –≤—ã –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª–∏ –ø–ª–æ—Ç—å –≤ –æ—Ä—É–∂–∏–µ. –í—ã —Å–ø–æ—Å–æ–±–Ω—ã —É—Å–∏–ª–∏–≤–∞—Ç—å —Å–µ–±—è –¥–æ —á—É–¥–æ–≤–∏—â–Ω—ã—Ö –ø—Ä–µ–¥–µ–ª–æ–≤, —Ä–∞–∑—Ä—É—à–∞—Ç—å –ø–ª–æ—Ç—å –≤—Ä–∞–≥–æ–≤ –∫–∞—Å–∞–Ω–∏–µ–º –∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –≥–∏–±—Ä–∏–¥–Ω—ã–µ —Ñ–æ—Ä–º—ã. –ù–æ —Å –∫–∞–∂–¥—ã–º –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ–º –≤—ã —Ç–µ—Ä—è–µ—Ç–µ —á–µ–ª–æ–≤–µ—á–Ω–æ—Å—Ç—å.",
    "–º–∞—Ç–µ—Ä–∏—è_—Å–≤–µ—Ç": "**–ü—É—Ç—å –¢–≤–æ—Ä—Ü–∞**: –≤—ã —Å–æ–∑–¥–∞—ë—Ç–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å —á–∏—Å—Ç—ã–º–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è–º–∏. –í–∞—à–∏ —Ç–≤–æ—Ä–µ–Ω–∏—è —Å–ª—É–∂–∞—Ç –∑–∞—â–∏—Ç–µ –∏ —Å–æ–∑–∏–¥–∞–Ω–∏—é. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –∫–∞–º–µ–Ω—å –≤ –º–µ—Ç–∞–ª–ª, –∞ –º–µ—á—Ç—É ‚Äî –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å.",
    "–º–∞—Ç–µ—Ä–∏—è_—Ç—å–º–∞": "**–ü—É—Ç—å –í–æ–∏–Ω–∞ –ú–∞—Ç–µ—Ä–∏–∏**: –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –º–∞—Ç–µ—Ä–∏—é –¥–ª—è —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è. –í–∞—à–µ –æ—Ä—É–∂–∏–µ –Ω–µ –∑–Ω–∞–µ—Ç –ø–æ—â–∞–¥—ã, –∞ –≤—Ä–∞–∂–µ—Å–∫–∏–µ –¥–æ—Å–ø–µ—Ö–∏ —Ä–∞—Å—Å—ã–ø–∞—é—Ç—Å—è –≤ –ø—Ä–∞—Ö. –ù–æ —Å–æ–∑–∏–¥–∞–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –¥–ª—è –≤–∞—Å —á—É–∂–¥—ã–º.",
    "–≤—Ä–µ–º—è_—Å–≤–µ—Ç": "**–ü—É—Ç—å –•—Ä–æ–Ω–∏–∫—ë—Ä–∞**: –≤—ã –Ω–∞–±–ª—é–¥–∞–µ—Ç–µ –≤—Ä–µ–º—è, –Ω–µ –≤–º–µ—à–∏–≤–∞—è—Å—å. –í—ã –º–æ–∂–µ—Ç–µ –∑–∞–º–µ–¥–ª—è—Ç—å –µ–≥–æ, –≤–∏–¥–µ—Ç—å –ø—Ä–æ—à–ª–æ–µ –∏ –∑–∞–≥–ª—è–¥—ã–≤–∞—Ç—å –≤ –≥—Ä—è–¥—É—â–µ–µ. –í–∞—à–∞ –º—É–¥—Ä–æ—Å—Ç—å ‚Äî –≤–∞—à–∞ —Å–∏–ª–∞.",
    "–≤—Ä–µ–º—è_—Ç—å–º–∞": "**–ü—É—Ç—å –†–∞–∑—Ä—É—à–∏—Ç–µ–ª—è –í—Ä–µ–º–µ–Ω–∏**: –≤—ã —É—Å–∫–æ—Ä—è–µ—Ç–µ –∏ —Å—Ç–∞—Ä–∏—Ç–µ, –≤—ã—Ä—ã–≤–∞–µ—Ç–µ –º–≥–Ω–æ–≤–µ–Ω–∏—è –∏–∑ –∂–∏–∑–Ω–∏ –≤—Ä–∞–≥–æ–≤. –ù–æ –∫–∞–∂–¥–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∞ –≤–∞—Å –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ä–∞–Ω—É.",
    "—Å–Ω—ã_—Å–≤–µ—Ç": "**–ü—É—Ç—å –ú–µ—á—Ç–∞—Ç–µ–ª—è**: –≤—ã –ø—Ä–∏–Ω—è–ª–∏ —Å–≤–æ–∏ —Å—Ç—Ä–∞—Ö–∏ –∏ –Ω–∞—É—á–∏–ª–∏—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–µ—Ç–ª—ã–µ –∏–ª–ª—é–∑–∏–∏, –ª–µ—á–∏—Ç—å –¥—É—à–µ–≤–Ω—ã–µ —Ä–∞–Ω—ã –∏ –¥–∞—Ä–∏—Ç—å –Ω–∞–¥–µ–∂–¥—É. –í–∞—à–∏ —Å–Ω—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —è–≤—å—é, –Ω–µ —Ä–∞–∑—Ä—É—à–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å.",
    "—Å–Ω—ã_—Ç—å–º–∞": "**–ü—É—Ç—å –ö–æ—à–º–∞—Ä–∞**: –≤—ã –≤—Å–µ–ª—è–µ—Ç–µ —É–∂–∞—Å, —É–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Å—Ç—Ä–∞—Ö–∞–º–∏ –∏ –∫—Ä–∞–¥—ë—Ç–µ —Å–Ω—ã. –ù–æ –≤–∞—à–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ—à–º–∞—Ä—ã —Ç–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ —Å –≤–∞–º–∏.",
    "–æ–∫–æ–≤—ã_—Å–≤–µ—Ç": "**–ü—É—Ç—å –°—Ç—Ä–∞–∂–∞**: –≤—ã –∑–∞—â–∏—â–∞–µ—Ç–µ. –í–∞—à–∏ –±–∞—Ä—å–µ—Ä—ã –Ω–µ—Ä—É—à–∏–º—ã, –∞ —Å–æ—é–∑–Ω–∏–∫–∏ –ø–æ–¥ –≤–∞—à–µ–π –æ–ø–µ–∫–æ–π –Ω–µ—É—è–∑–≤–∏–º—ã. –í—ã ‚Äî —â–∏—Ç, –∑–∞ –∫–æ—Ç–æ—Ä—ã–º –º–æ–∂–Ω–æ —É–∫—Ä—ã—Ç—å—Å—è.",
    "–æ–∫–æ–≤—ã_—Ç—å–º–∞": "**–ü—É—Ç—å –¢—é—Ä–µ–º—â–∏–∫–∞**: –≤—ã —Å–∫–æ–≤—ã–≤–∞–µ—Ç–µ –∏ –ø–æ–¥–∞–≤–ª—è–µ—Ç–µ. –í–æ–ª—è –≤—Ä–∞–≥–æ–≤ –ª–æ–º–∞–µ—Ç—Å—è –ø–æ–¥ –≤–∞—à–∏–º –≤–∑–≥–ª—è–¥–æ–º, –∞ –º–∞–≥–∏—è –∑–∞—Ç–∏—Ö–∞–µ—Ç. –ù–æ —Ü–µ–ø–∏, —á—Ç–æ –≤—ã –∫—É—ë—Ç–µ, —Å–∫–æ–≤—ã–≤–∞—é—Ç –∏ –≤–∞—Å.",
    "—Ç–µ–Ω—å_—Å–≤–µ—Ç": "**–ü—É—Ç—å –¶–µ–ª–æ—Å—Ç–Ω–æ–≥–æ**: –≤—ã –ø—Ä–∏–Ω—è–ª–∏ —Å–≤–æ—é —Ç–µ–Ω—å –∏ —Å–ª–∏–ª–∏—Å—å —Å –Ω–µ–π. –¢–µ–ø–µ—Ä—å –≤—ã —Å–≤–æ–±–æ–¥–Ω–æ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç–µ—Å—å –º–µ–∂–¥—É –º–∏—Ä–∞–º–∏, –∞ –≤–∞—à–∞ —Ç–µ–Ω—å ‚Äî –≤–∞—à –≤–µ—Ä–Ω—ã–π —Å–æ—é–∑–Ω–∏–∫.",
    "—Ç–µ–Ω—å_—Ç—å–º–∞": "**–ü—É—Ç—å –ü–æ–≥–ª–æ—â—ë–Ω–Ω–æ–≥–æ**: –≤—ã –æ—Ç–≤–µ—Ä–≥–ª–∏ —Ç–µ–Ω—å –∏ –ø—ã—Ç–∞–ª–∏—Å—å –µ—ë —É–Ω–∏—á—Ç–æ–∂–∏—Ç—å, –Ω–æ –æ–Ω–∞ –ø–æ–≥–ª–æ—â–∞–µ—Ç –≤–∞—Å –∏–∑–Ω—É—Ç—Ä–∏. –í—ã –æ–±—Ä–µ–ª–∏ –æ–≥—Ä–æ–º–Ω—É—é —Å–∏–ª—É, –Ω–æ —Å –∫–∞–∂–¥—ã–º –¥–Ω—ë–º —Ç–µ—Ä—è–µ—Ç–µ —Å–µ–±—è.",
    "—Å–≤–µ—Ç_—Å–≤–µ—Ç": "**–ü—É—Ç—å –ü—Ä–æ–≤–∏–¥—Ü–∞**: –≤—ã –ø—Ä–∏–∑–Ω–∞–ª–∏ —Å–≤–æ–∏ –≥—Ä–µ—Ö–∏ –∏ —Å—Ç–∞–ª–∏ —á–∏—Å—Ç—ã–º –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã. –í—ã –≤–∏–¥–∏—Ç–µ –ª–æ–∂—å, –ø—Ä–æ—Ä–æ—á–∏—Ç–µ –±—É–¥—É—â–µ–µ –∏ –∏—Å–ø–µ–ø–µ–ª—è–µ—Ç–µ —Ç—å–º—É. –ù–æ —Å–≤–µ—Ç –≤–Ω—É—Ç—Ä–∏ –≤–∞—Å —Ç—Ä–µ–±—É–µ—Ç —á–µ—Å—Ç–Ω–æ—Å—Ç–∏ –≤—Å–µ–≥–¥–∞.",
    "—Å–≤–µ—Ç_—Ç—å–º–∞": "**–ü—É—Ç—å –û—Å–ª–µ–ø–∏—Ç–µ–ª—å–Ω–æ–≥–æ**: –≤—ã –ø–æ–ø—ã—Ç–∞–ª–∏—Å—å —Å–ø—Ä—è—Ç–∞—Ç—å—Å—è –æ—Ç —Å–≤–µ—Ç–∞, –Ω–æ –æ–Ω –≤—ã–∂–µ–≥ –≤–∞–º –≥–ª–∞–∑–∞. –í—ã –æ—Å–ª–µ–ø–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏, –Ω–æ –æ–±—Ä–µ–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –∑—Ä–µ–Ω–∏–µ. –í–∞—à —Å–≤–µ—Ç —Å—Ç–∞–ª —á—ë—Ä–Ω—ã–º –∏ —Å–µ–µ—Ç —Å–ª–µ–ø–æ—Ç—É —Å—Ä–µ–¥–∏ –≤—Ä–∞–≥–æ–≤.",
    "–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ_—Å–≤–µ—Ç": "**–ü—É—Ç—å –ú–∞–Ω–¥—Ä–∞**: –≤—ã –¥–æ–≤–µ—Ä–∏–ª–∏—Å—å –∏–Ω—Ç—É–∏—Ü–∏–∏ –∏ –Ω–∞—É—á–∏–ª–∏—Å—å –Ω–∞—Ö–æ–¥–∏—Ç—å –¥–æ—Ä–æ–≥—É –≤ –ª—é–±—ã—Ö –ª–∞–±–∏—Ä–∏–Ω—Ç–∞—Ö. –í—ã —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç–µ—Å—å, —Å–æ–∑–¥–∞—ë—Ç–µ –ø–æ—Ä—Ç–∞–ª—ã –∏ –≤—Å–µ–≥–¥–∞ –∑–Ω–∞–µ—Ç–µ, –≥–¥–µ –≤—ã—Ö–æ–¥.",
    "–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ_—Ç—å–º–∞": "**–ü—É—Ç—å –ò—Å–∫–∞–∑–∏—Ç–µ–ª—è**: –≤—ã —Ä–∞–∑—Ä—É—à–∞–ª–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, —á—Ç–æ–±—ã –≤—ã—Ä–≤–∞—Ç—å—Å—è. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ —Å–∂–∏–º–∞—Ç—å –∏ —Ä–∞–∑—Ä—ã–≤–∞—Ç—å –µ–≥–æ, –ª–æ–≤–∏—Ç—å –≤—Ä–∞–≥–æ–≤ –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –∫–æ—Ä–∏–¥–æ—Ä—ã. –ù–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∏—Å–∫–∞–∂–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å, –≤—ã –∏—Å–∫–∞–∂–∞–µ—Ç–µ –∏ —Å–µ–±—è.",
    "–¥—É—à–∞_—Å–≤–µ—Ç": "**–ü—É—Ç—å –ü–∞—Å—Ç—ã—Ä—è**: –≤—ã –≤–æ—Å–∫—Ä–µ—Å–∏–ª–∏ –¥—É—à—É –∏–∑ —á–∏—Å—Ç–æ–π –ª—é–±–≤–∏. –¢–µ–ø–µ—Ä—å –≤—ã –ø—Ä–æ–≤–æ–∂–∞–µ—Ç–µ –º—ë—Ä—Ç–≤—ã—Ö, –∏—Å—Ü–µ–ª—è–µ—Ç–µ –¥—É—à–µ–≤–Ω—ã–µ —Ä–∞–Ω—ã –∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–∏—Ç—å –¥—É—Ö–æ–≤ –æ –ø–æ–º–æ—â–∏. –û–Ω–∏ —Å–ª—ã—à–∞—Ç –≤–∞—Å.",
    "–¥—É—à–∞_—Ç—å–º–∞": "**–ü—É—Ç—å –ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∞**: –≤—ã –≤–µ—Ä–Ω—É–ª–∏ –¥—É—à—É —Ä–∞–¥–∏ –≤—ã–≥–æ–¥—ã –∏ –ø—Ä–∏–≤—è–∑–∞–ª–∏ –µ—ë –∫ —Å–µ–±–µ. –¢–µ–ø–µ—Ä—å –≤—ã –ø–æ–≤–µ–ª–µ–≤–∞–µ—Ç–µ –º—ë—Ä—Ç–≤—ã–º–∏, –Ω–æ –≤–∞—à–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –¥—É—à–∞ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —á–µ—Ä–Ω–µ–µ—Ç –∏ —Ç—è–∂–µ–ª–µ–µ—Ç.",
    "—Ö–∞–æ—Å_—Å–≤–µ—Ç": "**–ü—É—Ç—å –ò–≥—Ä–æ–∫–∞**: –≤—ã –ø—Ä–∏–Ω—è–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∫–∞–∫–æ–π –±—ã –æ–Ω –Ω–∏ –±—ã–ª. –¢–µ–ø–µ—Ä—å –≤—ã —É–º–µ–µ—Ç–µ –≤–ª–∏—è—Ç—å –Ω–∞ —É–¥–∞—á—É, –Ω–µ —Ç–µ—Ä—è—è –∫–æ–Ω—Ç—Ä–æ–ª—è. –í–∞—à–µ –≤–µ–∑–µ–Ω–∏–µ ‚Äî –≤–∞—à–∞ –≤–æ–ª—è.",
    "—Ö–∞–æ—Å_—Ç—å–º–∞": "**–ü—É—Ç—å –û—Ç—á–∞—è–Ω–Ω–æ–≥–æ**: –≤—ã –ø–æ–ø—ã—Ç–∞–ª–∏—Å—å –æ–±–º–∞–Ω—É—Ç—å —Ö–∞–æ—Å, –∏ –æ–Ω –∏—Å–∫–∞–∑–∏–ª –≤–∞—Å. –í—ã —Å—Ç–∞–ª–∏ –∂–∏–≤—ã–º –≤–æ–ø–ª–æ—â–µ–Ω–∏–µ–º –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏, –Ω–æ –≤–∞—à–∞ —Å–∏–ª–∞ –≤—Å–µ–≥–¥–∞ –±—å—ë—Ç –∏ –ø–æ –≤–∞–º —Å–∞–º–∏–º.",
    "–∑–≤—É–∫_—Å–≤–µ—Ç": "**–ü—É—Ç—å –ì–∞—Ä–º–æ–Ω–∏—Å—Ç–∞**: –≤—ã –Ω–∞—à–ª–∏ –º–µ–ª–æ–¥–∏—é —Å—Ä–µ–¥–∏ —Ö–∞–æ—Å–∞. –í—ã –∏—Å—Ü–µ–ª—è–µ—Ç–µ –∑–≤—É–∫–æ–º, —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç–µ –±—É—Ä–∏ –∏ —Å–æ–∑–¥–∞—ë—Ç–µ –º—É–∑—ã–∫—É, —á—Ç–æ —Ç—Ä–æ–≥–∞–µ—Ç –¥—É—à–∏. –ú–∏—Ä –∑–≤—É—á–∏—Ç –¥–ª—è –≤–∞—Å –≤ —É–Ω–∏—Å–æ–Ω.",
    "–∑–≤—É–∫_—Ç—å–º–∞": "**–ü—É—Ç—å –ö–∞–∫–æ—Ñ–æ–Ω–∏—Å—Ç–∞**: –≤—ã –∑–∞—Å—Ç–∞–≤–∏–ª–∏ –º–∏—Ä –∑–∞–º–æ–ª—á–∞—Ç—å. –í—ã —Ä–∞–∑—Ä—É—à–∞–µ—Ç–µ —Ä–µ–∑–æ–Ω–∞–Ω—Å–æ–º, –∫—Ä–∏–∫ –≤–∞—à —É–±–∏–≤–∞–µ—Ç, –∞ —Ç–∏—à–∏–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Ä—É–∂–∏–µ–º. –ù–æ –≤—ã –±–æ–ª—å—à–µ –Ω–µ —Å–ª—ã—à–∏—Ç–µ –Ω–∏—á–µ–≥–æ, –∫—Ä–æ–º–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –ø—É—Å—Ç–æ—Ç—ã.",
    "—Ä–∞–∑—É–º_—Å–≤–µ—Ç": "**–ü—É—Ç—å –ú—É–¥—Ä–µ—Ü–∞**: –≤—ã –∑–∞–¥–∞–ª–∏ –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å –∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ —Å–µ–±—è. –í—ã —á–∏—Ç–∞–µ—Ç–µ –º—ã—Å–ª–∏, –¥–≤–∏–≥–∞–µ—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏ –æ–±—â–∞–µ—Ç–µ—Å—å –º–µ–Ω—Ç–∞–ª—å–Ω–æ. –í–∞—à —Ä–∞–∑—É–º —è—Å–µ–Ω, –∫–∞–∫ –≥–æ—Ä–Ω–æ–µ –æ–∑–µ—Ä–æ.",
    "—Ä–∞–∑—É–º_—Ç—å–º–∞": "**–ü—É—Ç—å –í–ª–∞—Å—Ç–µ–ª–∏–Ω–∞**: –≤—ã –ø–æ–ø—ã—Ç–∞–ª–∏—Å—å –æ–±—ä—è—Ç—å –Ω–µ–æ–±—ä—è—Ç–Ω–æ–µ –∏ –ø–æ—Ç–µ—Ä—è–ª–∏ —á–∞—Å—Ç—å —Å–µ–±—è. –í—ã –ø–æ–¥—á–∏–Ω—è–µ—Ç–µ –≤–æ–ª—é –¥—Ä—É–≥–∏—Ö, –Ω–æ –≤ –≤–∞—à–µ–π –≥–æ–ª–æ–≤–µ –∑–≤—É—á–∞—Ç –≥–æ–ª–æ—Å–∞ –≤—Å–µ—Ö, –∫–µ–º –≤—ã —É–ø—Ä–∞–≤–ª—è–ª–∏.",
    "—Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ_—Å–≤–µ—Ç": "**–ü—É—Ç—å –ú–∏—Ä–æ—Ç–≤–æ—Ä—Ü–∞**: –≤—ã –ø—Ä–∏–Ω—è–ª–∏ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ —Å–≤–µ—Ç–∞ –∏ —Ç—å–º—ã –≤ —Å–µ–±–µ. –í—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ –≥–∞—Ä–º–æ–Ω–∏—é, —É—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç–µ —Å–∏–ª—ã –∏ –¥–∞—Ä–∏—Ç–µ –ø–æ–∫–æ–π. –í—ã —Å–∞–º–∏ ‚Äî –≤–æ–ø–ª–æ—â–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞.",
    "—Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ_—Ç—å–º–∞": "**–ü—É—Ç—å –í–µ—Ä—à–∏—Ç–µ–ª—è**: –≤—ã –ø–æ–ø—ã—Ç–∞–ª–∏—Å—å –æ–±–º–∞–Ω—É—Ç—å –≤–µ—Å—ã –∏ —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç–µ –≤—Å–µ—Ö –≤–æ–∫—Ä—É–≥. –í—ã –∑–∞–±–∏—Ä–∞–µ—Ç–µ —É —Å–∏–ª—å–Ω—ã—Ö –∏ –æ—Ç–¥–∞—ë—Ç–µ —Å–ª–∞–±—ã–º, –Ω–æ –≤–∞—à–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –¥—É—à–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–Ω–∞–µ—Ç –ø–æ–∫–æ—è.",
}
BRANCH_DISPLAY_NAMES = {
    "–ø–ª–æ—Ç—å_—Å–≤–µ—Ç": "üåø –ü–ª–æ—Ç—å: –ü—É—Ç—å –¶–µ–ª–∏—Ç–µ–ª—è",
    "–ø–ª–æ—Ç—å_—Ç—å–º–∞": "‚öîÔ∏è –ü–ª–æ—Ç—å: –ü—É—Ç—å –†–∞–∑—Ä—É—à–∏—Ç–µ–ª—è",
    "–º–∞—Ç–µ—Ä–∏—è_—Å–≤–µ—Ç": "üî® –ú–∞—Ç–µ—Ä–∏—è: –ü—É—Ç—å –¢–≤–æ—Ä—Ü–∞",
    "–º–∞—Ç–µ—Ä–∏—è_—Ç—å–º–∞": "‚õìÔ∏è –ú–∞—Ç–µ—Ä–∏—è: –ü—É—Ç—å –í–æ–∏–Ω–∞ –ú–∞—Ç–µ—Ä–∏–∏",
    "–≤—Ä–µ–º—è_—Å–≤–µ—Ç": "‚è≥ –í—Ä–µ–º—è: –ü—É—Ç—å –•—Ä–æ–Ω–∏–∫—ë—Ä–∞",
    "–≤—Ä–µ–º—è_—Ç—å–º–∞": "‚åõ –í—Ä–µ–º—è: –ü—É—Ç—å –†–∞–∑—Ä—É—à–∏—Ç–µ–ª—è –í—Ä–µ–º–µ–Ω–∏",
    "—Å–Ω—ã_—Å–≤–µ—Ç": "üí≠ –°–Ω—ã: –ü—É—Ç—å –ú–µ—á—Ç–∞—Ç–µ–ª—è",
    "—Å–Ω—ã_—Ç—å–º–∞": "üåë –°–Ω—ã: –ü—É—Ç—å –ö–æ—à–º–∞—Ä–∞",
    "–æ–∫–æ–≤—ã_—Å–≤–µ—Ç": "üõ°Ô∏è –û–∫–æ–≤—ã: –ü—É—Ç—å –°—Ç—Ä–∞–∂–∞",
    "–æ–∫–æ–≤—ã_—Ç—å–º–∞": "üîó –û–∫–æ–≤—ã: –ü—É—Ç—å –¢—é—Ä–µ–º—â–∏–∫–∞",
    "—Ç–µ–Ω—å_—Å–≤–µ—Ç": "‚ú® –¢–µ–Ω—å: –ü—É—Ç—å –¶–µ–ª–æ—Å—Ç–Ω–æ–≥–æ",
    "—Ç–µ–Ω—å_—Ç—å–º–∞": "üåò –¢–µ–Ω—å: –ü—É—Ç—å –ü–æ–≥–ª–æ—â—ë–Ω–Ω–æ–≥–æ",
    "—Å–≤–µ—Ç_—Å–≤–µ—Ç": "‚òÄÔ∏è –°–≤–µ—Ç: –ü—É—Ç—å –ü—Ä–æ–≤–∏–¥—Ü–∞",
    "—Å–≤–µ—Ç_—Ç—å–º–∞": "üï∂Ô∏è –°–≤–µ—Ç: –ü—É—Ç—å –û—Å–ª–µ–ø–∏—Ç–µ–ª—å–Ω–æ–≥–æ",
    "–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ_—Å–≤–µ—Ç": "üåÄ –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ: –ü—É—Ç—å –ú–∞–Ω–¥—Ä–∞",
    "–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ_—Ç—å–º–∞": "üå™Ô∏è –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ: –ü—É—Ç—å –ò—Å–∫–∞–∑–∏—Ç–µ–ª—è",
    "–¥—É—à–∞_—Å–≤–µ—Ç": "üëº –î—É—à–∞: –ü—É—Ç—å –ü–∞—Å—Ç—ã—Ä—è",
    "–¥—É—à–∞_—Ç—å–º–∞": "üíÄ –î—É—à–∞: –ü—É—Ç—å –ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∞",
    "—Ö–∞–æ—Å_—Å–≤–µ—Ç": "üé≤ –•–∞–æ—Å: –ü—É—Ç—å –ò–≥—Ä–æ–∫–∞",
    "—Ö–∞–æ—Å_—Ç—å–º–∞": "üî• –•–∞–æ—Å: –ü—É—Ç—å –û—Ç—á–∞—è–Ω–Ω–æ–≥–æ",
    "–∑–≤—É–∫_—Å–≤–µ—Ç": "üéµ –ó–≤—É–∫: –ü—É—Ç—å –ì–∞—Ä–º–æ–Ω–∏—Å—Ç–∞",
    "–∑–≤—É–∫_—Ç—å–º–∞": "üîá –ó–≤—É–∫: –ü—É—Ç—å –ö–∞–∫–æ—Ñ–æ–Ω–∏—Å—Ç–∞",
    "—Ä–∞–∑—É–º_—Å–≤–µ—Ç": "üß† –†–∞–∑—É–º: –ü—É—Ç—å –ú—É–¥—Ä–µ—Ü–∞",
    "—Ä–∞–∑—É–º_—Ç—å–º–∞": "üëÅÔ∏è –†–∞–∑—É–º: –ü—É—Ç—å –í–ª–∞—Å—Ç–µ–ª–∏–Ω–∞",
    "—Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ_—Å–≤–µ—Ç": "‚öñÔ∏è –†–∞–≤–Ω–æ–≤–µ—Å–∏–µ: –ü—É—Ç—å –ú–∏—Ä–æ—Ç–≤–æ—Ä—Ü–∞",
    "—Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ_—Ç—å–º–∞": "üîÆ –†–∞–≤–Ω–æ–≤–µ—Å–∏–µ: –ü—É—Ç—å –í–µ—Ä—à–∏—Ç–µ–ª—è",
}

# ===== –õ–û–ì–ì–ò–†–û–í–ê–ù–ò–ï =====
logging.basicConfig(format="%(asctime)s - %(name)s - %(levelname)s - %(message)s", level=logging.INFO)
logger = logging.getLogger(__name__)

# ===== –ü–û–ò–°–ö –í–ï–¢–í–ò –ü–û –ö–õ–Æ–ß–ï–í–´–ú –°–õ–û–í–ê–ú =====
def find_branch_by_text(text):
    words = set(text.lower().split())
    for branch_key, variants in CONDITIONS.items():
        for variant in variants:
            if all(word in words for word in variant):
                return branch_key
    return None

# ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò =====
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    await update.message.reply_text(
        "–ü—Ä–∏–≤–µ—Ç, –∏—Å–∫–∞—Ç–µ–ª—å! –Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫—É –≤–µ—Ç–≤–µ–π –º–∞–≥–∏–∏.\n"
        "–ö–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω–∏—à—å —É—Å–ª–æ–≤–∏–µ, –Ω–∞–ø–∏—à–∏ –º–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –æ–ø–∏—Å—ã–≤–∞—é—â–µ–µ —Ç–≤–æ–π –ø–æ–¥–≤–∏–≥. "
        "–Ø —Å–∞–º –ø–æ–π–º—É, –∫–∞–∫—É—é –≤–µ—Ç–≤—å —Ç—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª."
    )
async def my_branches(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤–µ—Ç–≤–µ–π –º–∞–≥–∏–∏."""
    user_id = update.effective_user.id
    unlocked = get_user_branches(user_id)

    if not unlocked:
        await update.message.reply_text(
            "üåü –¢—ã –ø–æ–∫–∞ –Ω–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –Ω–∏ –æ–¥–Ω–æ–π –≤–µ—Ç–≤–∏ –º–∞–≥–∏–∏.\n"
            "–ò–¥–∏, –∏—Å–∫–∞—Ç–µ–ª—å, —Å–æ–≤–µ—Ä—à–∞–π –ø–æ–¥–≤–∏–≥–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è —Å –Ω–æ–≤—ã–º–∏ —Å–∏–ª–∞–º–∏!"
        )
        return

    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
    sorted_branches = sorted(unlocked)
    lines = []
    for branch_key in sorted_branches:
        display_name = BRANCH_DISPLAY_NAMES.get(branch_key, branch_key)
        lines.append(f"‚Ä¢ {display_name}")

    text = "‚ú® **–¢–≤–æ–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ç–≤–∏ –º–∞–≥–∏–∏:** ‚ú®\n\n" + "\n".join(lines)
    await update.message.reply_text(text, parse_mode="Markdown")

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    await update.message.reply_text(
        "–≠—Ç–æ—Ç –±–æ—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ –≤–µ—Ç–≤–∏ –º–∞–≥–∏–∏ —Ç—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –≤ —Ä–æ–ª–µ–≤–æ–π –∏–≥—Ä–µ.\n"
        "–ö–æ–≥–¥–∞ —Å–æ–≤–µ—Ä—à–∞–µ—à—å –≤—ã–±–æ—Ä –≤ –∏—Å–ø—ã—Ç–∞–Ω–∏–∏, –ø—Ä–æ—Å—Ç–æ –æ–ø–∏—à–∏ –µ–≥–æ —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ ‚Äî "
        "—è –Ω–∞–π–¥—É –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏ –∑–∞—Å—á–∏—Ç–∞—é –Ω—É–∂–Ω—É—é –≤–µ—Ç–≤—å.\n"
        "–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Ç—ã –æ–±–Ω—è–ª —Å–≤–æ—ë –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ, –Ω–∞–ø–∏—à–∏ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ '—è –æ–±–Ω—è–ª —Å–≤–æ—ë –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ –≤ –ª–∞–±–∏—Ä–∏–Ω—Ç–µ'."
    )

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    user_id = update.effective_user.id
    text = update.message.text.lower().strip()
    if not text:
        return

    unlocked = get_user_branches(user_id)
    branch_key = find_branch_by_text(text)

    if branch_key:
        branch_root = get_branch_root(branch_key)
        # –ü–æ–ª—É—á–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∫–æ—Ä–Ω–µ–π —É–∂–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –≤–µ—Ç–≤–µ–π
        existing_roots = {get_branch_root(b) for b in unlocked}

        if branch_root in existing_roots:
            await update.message.reply_text(
                "‚ùå –¢—ã —É–∂–µ —Å–¥–µ–ª–∞–ª –≤—ã–±–æ—Ä –¥–ª—è —ç—Ç–æ–π –∏—Å–∫—Ä—ã. –ù–µ–ª—å–∑—è –∏–¥—Ç–∏ –¥–≤—É–º—è –ø—É—Ç—è–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.\n"
                "–î–æ—Ä–æ–≥–∞ —Ç—Ä–µ–±–æ–≤–∞–ª–∞ –æ–¥–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è, –∏ —Ç—ã –µ–≥–æ –ø—Ä–∏–Ω—è–ª."
            )
        elif branch_key in unlocked:
            await update.message.reply_text("‚ö†Ô∏è –¢—ã —É–∂–µ –ø–æ–ª—É—á–∏–ª —ç—Ç—É –≤–µ—Ç–≤—å –º–∞–≥–∏–∏. –ò–¥–∏ –¥–∞–ª—å—à–µ, –∏—Å–∫–∞—Ç–µ–ª—å!")
        else:
            unlocked.add(branch_key)
            save_user_branches(user_id, unlocked)
            description = BRANCH_DESCRIPTIONS.get(branch_key, "–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.")
            await update.message.reply_text(
                f"üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –¢—ã –≤—ã–ø–æ–ª–Ω–∏–ª —É—Å–ª–æ–≤–∏–µ –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –Ω–æ–≤—É—é –≤–µ—Ç–≤—å –º–∞–≥–∏–∏.\n\n{description}"
            )
    # –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ

# ===== –ó–ê–ü–£–°–ö =====
def main():
    init_db()
    app = Application.builder().token(TOKEN).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("help", help_command))
    app.add_handler(CommandHandler("mybranches", my_branches))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
    app.run_polling()
    

if __name__ == "__main__":
    main()


